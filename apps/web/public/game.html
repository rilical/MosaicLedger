<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Minesweeper (180s)</title>
    <style>
      :root{
        --bg0:#0b1220;--bg1:#050712;--card:rgba(255,255,255,.06);
        --t:#eef2ff;--mut:rgba(238,242,255,.7);--b:rgba(255,255,255,.12);
        --good:#22c55e;--warn:#f97316;--bad:#f43f5e;--accent:#38bdf8;
        --cell:#0f1a30;--cell2:#0b1528;--rev:#0a1020;
      }
      *{box-sizing:border-box}html,body{height:100%}body{
        margin:0;font:14px/1.4 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
        color:var(--t);background:radial-gradient(1200px 700px at 20% 0%,#182a55 0%,var(--bg0) 42%,var(--bg1) 100%);
        display:flex;align-items:center;justify-content:center;padding:18px;
      }
      .app{width:min(520px,100%);display:grid;gap:14px}
      .top{display:flex;gap:10px;align-items:flex-start;justify-content:space-between}
      h1{margin:0;font-size:18px;letter-spacing:.2px}
      .meta{color:var(--mut);font-size:12px}
      .card{background:var(--card);border:1px solid var(--b);border-radius:14px;padding:12px}
      .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
      .pill{border:1px solid var(--b);border-radius:999px;padding:6px 10px;background:rgba(0,0,0,.22);font-size:12px}
      .pill b{font-weight:700}
      .btns{display:flex;gap:8px;flex-wrap:wrap}
      button{appearance:none;border:1px solid var(--b);background:rgba(0,0,0,.24);color:var(--t);border-radius:12px;padding:8px 10px;font-weight:650}
      button:active{transform:translateY(1px)}
      .primary{border-color:rgba(56,189,248,.45);background:rgba(56,189,248,.14)}
      .on{border-color:rgba(249,115,22,.55);background:rgba(249,115,22,.18)}
      .grid{
        display:grid;grid-template-columns:repeat(10,1fr);gap:6px;user-select:none;touch-action:manipulation;
      }
      .c{
        width:100%;aspect-ratio:1/1;border-radius:10px;border:1px solid rgba(255,255,255,.08);
        background:linear-gradient(180deg,var(--cell),var(--cell2));color:var(--t);font-weight:800;
        display:flex;align-items:center;justify-content:center;
      }
      .c.rev{background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.25));border-color:rgba(255,255,255,.10)}
      .c.flag{outline:2px solid rgba(234,179,8,.45)}
      .c.boom{background:linear-gradient(180deg,rgba(244,63,94,.38),rgba(0,0,0,.25));border-color:rgba(244,63,94,.55)}
      .c:focus{outline:2px solid rgba(56,189,248,.55);outline-offset:1px}
      .hint{color:var(--mut);font-size:12px}
      a{color:var(--accent)}
    </style>
  </head>
  <body>
    <div class="app">
      <div class="top">
        <div>
          <h1>Minesweeper (180s)</h1>
          <div class="meta">10x10 · 15 mines · first click safe</div>
        </div>
        <div class="pill" id="status">READY</div>
      </div>

      <div class="card">
        <div class="row">
          <div class="pill">Time: <b id="time">180</b>s</div>
          <div class="pill">Mines: <b id="mines">15</b></div>
          <div class="pill">Safe left: <b id="left">85</b></div>
          <div class="btns">
            <button id="flag" class="primary" type="button">Flag: OFF</button>
            <button id="restart" type="button">Restart</button>
          </div>
        </div>
        <div class="hint" style="margin-top:10px">
          Tap to reveal. Toggle Flag mode for safe mobile play. Optional seed: <code>?seed=demo</code>
        </div>
      </div>

      <div class="card">
        <div class="grid" id="grid" aria-label="Minesweeper board"></div>
      </div>
    </div>

    <script>
      (function(){
        var N=10,M=15,L=180,grid=document.getElementById('grid');
        var elT=document.getElementById('time'),elM=document.getElementById('mines'),elL=document.getElementById('left');
        var elS=document.getElementById('status'),btnF=document.getElementById('flag'),btnR=document.getElementById('restart');
        var flagMode=0,started=0,over=0,timer=0,remain=L,seed=location.search.match(/(?:\\?|&)seed=([^&]+)/);
        function h(s){for(var i=0,x=2166136261>>>0;i<s.length;i++){x^=s.charCodeAt(i);x=Math.imul(x,16777619);}return x>>>0}
        var rng=(function(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t^=t+Math.imul(t^t>>>7,61|t);return((t^t>>>14)>>>0)/4294967296}})(h(decodeURIComponent(seed?seed[1]:'0')));
        function idx(r,c){return r*N+c}
        function inb(r,c){return r>=0&&c>=0&&r<N&&c<N}
        function neigh(i){var r=i/N|0,c=i%N,a=[];for(var dr=-1;dr<=1;dr++)for(var dc=-1;dc<=1;dc++){if(!dr&&!dc)continue;var rr=r+dr,cc=c+dc;if(inb(rr,cc))a.push(idx(rr,cc));}return a}
        function setStatus(t,tone){elS.textContent=t;elS.style.borderColor=tone||'rgba(255,255,255,.12)'}
        function mk(){
          grid.innerHTML='';over=0;started=0;remain=L;elT.textContent=remain;setStatus('READY');
          S=[];for(var i=0;i<N*N;i++)S.push({m:0,r:0,f:0,a:0,b:0,el:null});
          for(var i=0;i<N*N;i++){
            var b=document.createElement('button');b.type='button';b.className='c';b.setAttribute('aria-label','cell');
            (function(ii,bb){
              bb.oncontextmenu=function(e){e.preventDefault();tog(ii);return false};
              var lp=0,tid=0;
              bb.ontouchstart=function(){lp=0;tid=setTimeout(function(){lp=1;tog(ii)},380)};
              bb.ontouchend=function(){clearTimeout(tid);if(!lp)act(ii)};
              bb.onclick=function(){act(ii)};
            })(i,b);
            S[i].el=b;grid.appendChild(b);
          }
          elM.textContent=M;safeLeft=N*N-M;elL.textContent=safeLeft;
        }
        function placeSafe(first){
          var ban={};ban[first]=1;var ns=neigh(first);for(var i=0;i<ns.length;i++)ban[ns[i]]=1;
          var spots=[];for(var i=0;i<N*N;i++)if(!ban[i])spots.push(i);
          for(var k=spots.length-1;k>0;k--){var j=(rng()* (k+1))|0;var t=spots[k];spots[k]=spots[j];spots[j]=t;}
          for(var i=0;i<M;i++)S[spots[i]].m=1;
          for(var i=0;i<N*N;i++){
            if(S[i].m)continue;
            var n=neigh(i),c=0;for(var j=0;j<n.length;j++)if(S[n[j]].m)c++;
            S[i].a=c;
          }
        }
        function start(){
          if(started)return;started=1;setStatus('RUNNING','rgba(56,189,248,.45)');
          timer=setInterval(function(){if(over)return;remain--;elT.textContent=remain;if(remain<=0){lose(-1)}},1000);
        }
        function tog(i){
          if(over)return;
          var s=S[i];if(s.r)return;
          s.f=!s.f;
          s.el.classList.toggle('flag',s.f);
          s.el.textContent=s.f?'F':'';
          var flags=0;for(var k=0;k<N*N;k++)if(S[k].f)flags++;
          elM.textContent=Math.max(0,M-flags);
        }
        function act(i){
          if(over)return;
          if(!started){placeSafe(i);start()}
          var s=S[i];
          if(flagMode){tog(i);return}
          if(s.f||s.r)return;
          if(s.m){lose(i);return}
          rev(i);
          if(safeLeft<=0)win();
        }
        function rev(i){
          var q=[i];
          while(q.length){
            var x=q.pop(),s=S[x];
            if(s.r||s.f)continue;
            s.r=1;safeLeft--;elL.textContent=safeLeft;
            s.el.classList.add('rev');
            if(s.a){s.el.textContent=s.a;continue}
            var n=neigh(x);
            for(var j=0;j<n.length;j++){var t=S[n[j]];if(!t.r&&!t.f&&!t.m)q.push(n[j])}
          }
        }
        function lose(hit){
          over=1;clearInterval(timer);
          setStatus(hit<0?'TIME OUT':'BOOM', 'rgba(244,63,94,.55)');
          for(var i=0;i<N*N;i++){
            var s=S[i];
            if(s.m){s.el.textContent='*';s.el.classList.add('rev')}
          }
          if(hit>=0)S[hit].el.classList.add('boom');
        }
        function win(){
          over=1;clearInterval(timer);
          setStatus('CLEARED','rgba(34,197,94,.55)');
        }
        btnF.onclick=function(){
          flagMode=!flagMode;
          btnF.textContent='Flag: '+(flagMode?'ON':'OFF');
          btnF.classList.toggle('on',flagMode);
        };
        btnR.onclick=function(){clearInterval(timer);mk()};
        var S=[],safeLeft=0;mk();
      })();
    </script>
  </body>
</html>

